<!DOCTYPE html>
<html>
    <head>
        <style>
            #space {
                width: 500px;
                height: 500px;
                background-color: black;
            }
            #center {
                pointer-events: none;
                color: white;
                position: absolute;
                left: 250px;
                top: 250px;
            }
            .particle {
                color: white;
                position: absolute;
                background-color: aqua;
                top: 100px;
                left: 100px;
            }
        </style>
    </head>
    <body>
        <div id="space">
            <div id="center">+</div>
        </div>
        <button id="add">add</button>
        <script>
            const MAX_COUNT = 100000;

            function Particle(element, positon, velocity){
                this.$el = element;
                this.velocity = velocity;
                this.setPosition(...positon);
                this.move();
            }

            Particle.prototype.setPosition = function(x, y){
                this.$el.style.left = x + "px";
                this.$el.style.top = y + "px";
            }

            Particle.prototype.getPosition = function(){
                return [parseInt(this.$el.style.left.replace('px', '')), parseInt(this.$el.style.top.replace('px', ''))];
            }

            Particle.prototype.move = function(){
                const interval = setInterval(() => {
                    let [x, y] = this.getPosition();
                    if(x > 500 || x < 0) this.velocity.x = -this.velocity.x;
                    if(y > 500 || y < 0) this.velocity.y = -this.velocity.y;
                    x = x + this.velocity.x;
                    y = y + this.velocity.y;
                    this.setPosition(x, y);
                    let occuredParticle = this.checkOccupie(particles);
                    //if(occuredParticle) this.impact(occuredParticle);
                }, 10);
            }

            Particle.prototype.checkOccupie = function(particles){
                let length = particles.length;
                let width = 10;
                let [thisX, thisY] = this.getPosition();
                for(let i = 0; i < length; i++){
                    let [particleX, particleY] = particles[i].getPosition();
                    if(this != particles[i] && Math.abs(thisX - particleX) < width && Math.abs(thisY - particleY) < width) return particles[i];
                }
            }

            Particle.prototype.impact = function(particle){
                /*let thisAngle = this.velocity.x / this.velocity.y;
                let particleAngle = particle.velocity.x / particle.velocity.y;*/
                let velocity = Math.sqrt(
                    (this.velocity.x+particle.velocity.x)*(this.velocity.x+particle.velocity.x) + 
                    (this.velocity.y+particle.velocity.y)*(this.velocity.y+particle.velocity.y)
                );
                let thisAbsVelocity = Math.sqrt(this.velocity.x*this.velocity.x + this.velocity.y*this.velocity.y);
                let particleAbsVelocity = Math.sqrt(particle.velocity.x*particle.velocity.x + particle.velocity.y*particle.velocity.y);
                if(thisAbsVelocity == 0) thisAbsVelocity = 0.1;
                if(particleAbsVelocity == 0) particleAbsVelocity = 0.1;
                let temp = {
                    x: this.velocity.x / thisAbsVelocity * velocity,
                    y: this.velocity.y / thisAbsVelocity * velocity,
                };
                this.velocity = {
                    x: particle.velocity.x / particleAbsVelocity * velocity,
                    y: particle.velocity.y / particleAbsVelocity * velocity,
                };
                particle.velocity = {...temp};
                console.log(temp)
            }

            let count = 0;
            let particles = [];
            document.getElementById('add').onclick = () => {
                let newDiv = document.createElement('div');
                newDiv.classList.add('particle');
                newDiv.append(count++);
                document.getElementById('space').appendChild(newDiv);
                particles.push(new Particle(newDiv, [Math.random() * 100, Math.random() * 100], {x: Math.random() * 10, y: Math.random() * 10}));
             };
        </script>
    </body>
</html>
